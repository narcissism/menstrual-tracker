<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Period Tracker with Moon & Phases</title>
<style>
body { font-family:sans-serif; margin:0; background:#fff; display:flex; flex-direction:column; align-items:center; }
#controls { margin-top:10px; }
button { margin:0 5px; }
#calendar { display:grid; grid-template-columns: repeat(7, 60px); gap:5px; margin-top:20px; }
.day { width:60px; height:60px; border:1px solid #ccc; display:flex; flex-direction:column; align-items:center; justify-content:center; cursor:pointer; position:relative; font-size:12px; }
.day.period { background:#fdd; }
.day.ovulation { background:#ffd; }
.day.follicular { background:#eef; }
.day.luteal { background:#efe; }
.day span.moon { position:absolute; bottom:2px; font-size:14px; }
.day span.intensity { position:absolute; top:2px; font-size:10px; }
.weekdays { display:grid; grid-template-columns:repeat(7, 60px); gap:5px; margin-top:10px; font-weight:bold; text-align:center; }
#modal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%); background:#fff; border:1px solid #333; padding:20px; z-index:10; }
#modal label { display:block; margin:5px 0; }
#modal input[type=checkbox] { margin-right:5px; }
#modal select { margin-bottom:10px; width:100%; }
#analysis { margin-top:20px; width:80%; }
</style>
</head>
<body>

<h1>Period Tracker</h1>

<div id="controls">
  <button id="prevMonth">â—€ Previous</button>
  <span id="monthLabel"></span>
  <button id="nextMonth">Next â–¶</button>
</div>

<div class="weekdays">
  <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
</div>

<div id="calendar"></div>

<div id="modal">
  <h3>Track Day</h3>
  <label><input type="checkbox" id="periodCheck"> Period</label>
  <label><input type="checkbox" id="lightCheck"> Light</label>
  <label><input type="checkbox" id="mediumCheck"> Medium</label>
  <label><input type="checkbox" id="heavyCheck"> Heavy</label>
  <label>Mood:
    <select id="moodSelect">
      <option value="">--</option>
      <option value="Happy">Happy</option>
      <option value="Irritable">Irritable</option>
      <option value="Sad">Sad</option>
      <option value="Anxious">Anxious</option>
    </select>
  </label>
  <label>Symptoms:
    <select id="symptomSelect" multiple size=4>
      <option value="Cramps">Cramps</option>
      <option value="Bloating">Bloating</option>
      <option value="Headache">Headache</option>
      <option value="Fatigue">Fatigue</option>
    </select>
  </label>
  <button id="saveBtn">Save</button>
  <button id="closeBtn">Close</button>
</div>

<div id="analysis">
  <h2>Analysis</h2>
  <div id="cycleLength"></div>
  <div id="periodLength"></div>
  <div id="symptomTrends"></div>
  <div id="phaseInfo"></div>
</div>

<script>
// DATA
let entries = {}; 
const calendar = document.getElementById('calendar');
let selectedDate = null;

// CURRENT VIEW
let viewYear = 2026;
let viewMonth = 0;

// MOON PHASES - Real Jan 2026
const moonPhases = {
  "2026-01-03":"ðŸŒ•",
  "2026-01-10":"ðŸŒ—",
  "2026-01-18":"ðŸŒ‘",
  "2026-01-26":"ðŸŒ“"
};
function moonIcon(date){
  const key = date.toISOString().split('T')[0];
  if(moonPhases[key]) return moonPhases[key];
  return '';
}

// CALENDAR BUILD
function buildCalendar(){
  document.getElementById('monthLabel').innerText = new Date(viewYear, viewMonth).toLocaleString('default',{month:'long', year:'numeric'});
  calendar.innerHTML='';
  const firstDay = new Date(viewYear, viewMonth,1);
  const lastDay = new Date(viewYear, viewMonth+1,0);
  const startDay = firstDay.getDay();
  for(let i=0;i<startDay;i++) calendar.appendChild(document.createElement('div'));
  for(let d=1; d<=lastDay.getDate(); d++){
    const date = new Date(viewYear, viewMonth,d);
    const key = date.toISOString().split('T')[0];
    const div = document.createElement('div');
    div.className='day';
    div.dataset.date=key;
    let intensity='';
    if(entries[key]){
      if(entries[key].period) div.classList.add('period');
      if(entries[key].phase==='Ovulation') div.classList.add('ovulation');
      if(entries[key].phase==='Follicular') div.classList.add('follicular');
      if(entries[key].phase==='Luteal') div.classList.add('luteal');
      if(entries[key].intensity) intensity = entries[key].intensity;
    }
    div.innerHTML = `<span>${d}</span><span class="moon">${moonIcon(date)}</span><span class="intensity">${intensity}</span>`;
    div.onclick = ()=>openModal(key);
    calendar.appendChild(div);
  }
}

// NAVIGATION
document.getElementById('prevMonth').onclick = ()=>{
  viewMonth--;
  if(viewMonth<0){ viewMonth=11; viewYear--; }
  buildCalendar();
}
document.getElementById('nextMonth').onclick = ()=>{
  viewMonth++;
  if(viewMonth>11){ viewMonth=0; viewYear++; }
  buildCalendar();
}

// MODAL
const modal = document.getElementById('modal');
const periodCheck = document.getElementById('periodCheck');
const lightCheck = document.getElementById('lightCheck');
const mediumCheck = document.getElementById('mediumCheck');
const heavyCheck = document.getElementById('heavyCheck');
const moodSelect = document.getElementById('moodSelect');
const symptomSelect = document.getElementById('symptomSelect');

document.getElementById('saveBtn').onclick = ()=>{
  let intensity='';
  if(lightCheck.checked) intensity='L';
  else if(mediumCheck.checked) intensity='M';
  else if(heavyCheck.checked) intensity='H';
  entries[selectedDate]={
    period: periodCheck.checked,
    intensity:intensity,
    mood: moodSelect.value,
    symptoms: Array.from(symptomSelect.selectedOptions).map(o=>o.value)
  };
  modal.style.display='none';
  assignPhases();
  buildCalendar();
  updateAnalysis();
};

document.getElementById('closeBtn').onclick = ()=>{ modal.style.display='none'; }
function openModal(date){
  selectedDate=date;
  const entry = entries[date] || {period:false,intensity:'', mood:'', symptoms:[]};
  periodCheck.checked=entry.period;
  lightCheck.checked=entry.intensity==='L';
  mediumCheck.checked=entry.intensity==='M';
  heavyCheck.checked=entry.intensity==='H';
  moodSelect.value=entry.mood;
  Array.from(symptomSelect.options).forEach(o=>o.selected=entry.symptoms.includes(o.value));
  modal.style.display='block';
}

// ANALYSIS
function updateAnalysis(){
  const keys=Object.keys(entries).sort();
  const periodStarts=keys.filter(k=>entries[k].period).map(k=>new Date(k));
  let cycles=[];
  for(let i=1;i<periodStarts.length;i++){
    const prevEnd = new Date(periodStarts[i-1].getTime());
    prevEnd.setDate(prevEnd.getDate()+1); // day after last period
    cycles.push(Math.round((periodStarts[i]-prevEnd)/(1000*60*60*24)));
  }
  document.getElementById('cycleLength').innerText = cycles.length>0?`Average cycle length: ${Math.round(cycles.reduce((a,b)=>a+b,0)/cycles.length)} days`:'Average cycle length: N/A';
  // period length
  let lengths=[];
  for(let i=0;i<periodStarts.length;i++){
    let start=periodStarts[i], count=1;
    for(let j=1;j<keys.length;j++){
      const next=new Date(keys[j]);
      if(next>start && entries[keys[j]]?.period) count++;
      else break;
    }
    lengths.push(count);
  }
  document.getElementById('periodLength').innerText = lengths.length>0?`Average period length: ${Math.round(lengths.reduce((a,b)=>a+b,0)/lengths.length)} days`:'Average period length: N/A';
  // symptoms
  const symptomCounts={};
  for(let k of keys){
    if(entries[k]?.symptoms) entries[k].symptoms.forEach(s=>{
      symptomCounts[s]=(symptomCounts[s]||0)+1;
    });
  }
  document.getElementById('symptomTrends').innerText='Symptom frequency: '+Object.entries(symptomCounts).map(([s,c])=>`${s}: ${c}`).join(', ');
  document.getElementById('phaseInfo').innerText='Cycle phases: Follicular (~Day1â€“10), Ovulation (~Day11â€“14), Luteal (~Day15â€“28)';
}

// CYCLE PHASE ASSIGNMENT
function assignPhases(){
  const keys=Object.keys(entries).sort();
  const periodStarts=keys.filter(k=>entries[k].period).map(k=>new Date(k));
  if(periodStarts.length<2) return;
  const cycleLength = Math.round((periodStarts[1]-periodStarts[0])/(1000*60*60*24));
  for(let i=0;i<keys.length;i++){
    const d=new Date(keys[i]);
    const daysSinceStart=Math.round((d-periodStarts[0])/(1000*60*60*24))+1;
    if(entries[keys[i]].period) entries[keys[i]].phase='Menstrual';
    else if(daysSinceStart>=11 && daysSinceStart<=14) entries[keys[i]].phase='Ovulation';
    else if(daysSinceStart<11) entries[keys[i]].phase='Follicular';
    else entries[keys[i]].phase='Luteal';
  }
}

// INIT
buildCalendar();
updateAnalysis();
</script>
</body>
</html>
